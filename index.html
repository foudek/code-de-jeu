<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Dernière Mise</title>
<style>
html,body{
  margin:0;
  background:black;
  overflow:hidden;
  font-family: monospace;
}
canvas{display:block;}
#ui{
  position:fixed;
  bottom:40px;
  width:100%;
  display:flex;
  justify-content:center;
  gap:40px;
}
button{
  background:none;
  color:white;
  border:1px solid white;
  padding:14px 28px;
  font-size:16px;
  cursor:pointer;
}
button:hover{
  background:white;
  color:black;
}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="ui"></div>

<script>

/* ===================== SETUP ===================== */

const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const ui = document.getElementById("ui");

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
addEventListener("resize",resize);
resize();

/* ===================== VARIABLES ===================== */

let scene = 0;
let lastScene = -1;
let t = 0;
let zoom = 1;
let zoomTarget = 1;
let cameraX = 0;
let cameraY = 0;
let cameraTargetX = 0;
let cameraTargetY = 0;
let choice = null;
let playersAlive = 4;

/* ===================== CINEMATIC CAMERA ===================== */

function updateCamera(){
  zoom += (zoomTarget - zoom) * 0.05;
  cameraX += (cameraTargetX - cameraX) * 0.05;
  cameraY += (cameraTargetY - cameraY) * 0.05;
}

function applyCamera(){
  ctx.translate(canvas.width/2,canvas.height/2);
  ctx.scale(zoom,zoom);
  ctx.translate(-canvas.width/2 + cameraX,-canvas.height/2 + cameraY);
}

/* ===================== DRAW UTIL ===================== */

function caption(text){
  ctx.fillStyle="white";
  ctx.font="18px monospace";
  ctx.fillText(text,40,60);
}

function hatching(x,y,w,h,density=20){
  for(let i=0;i<density;i++){
    ctx.beginPath();
    ctx.moveTo(x + Math.random()*w, y);
    ctx.lineTo(x, y + Math.random()*h);
    ctx.stroke();
  }
}

/* ===================== REALISTIC FACE ===================== */

function drawRealFace(x,y,scale,emotion="neutral",scar=false){

  ctx.save();
  ctx.translate(x,y);
  ctx.scale(scale,scale);
  ctx.lineWidth=1.2;
  ctx.strokeStyle="white";

  // crâne
  ctx.beginPath();
  ctx.ellipse(0,0,70,90,0,0,Math.PI*2);
  ctx.stroke();

  // mâchoire
  ctx.beginPath();
  ctx.moveTo(-50,40);
  ctx.lineTo(0,110);
  ctx.lineTo(50,40);
  ctx.stroke();

  // yeux
  ctx.beginPath();
  ctx.ellipse(-25,-10,18,8,0,0,Math.PI*2);
  ctx.ellipse(25,-10,18,8,0,0,Math.PI*2);
  ctx.stroke();

  ctx.beginPath();
  ctx.arc(-25,-10,4,0,Math.PI*2);
  ctx.arc(25,-10,4,0,Math.PI*2);
  ctx.fill();

  // sourcils
  ctx.beginPath();
  ctx.moveTo(-40,-25);
  ctx.lineTo(-10,-30);
  ctx.moveTo(40,-25);
  ctx.lineTo(10,-30);
  ctx.stroke();

  // nez
  ctx.beginPath();
  ctx.moveTo(0,-5);
  ctx.lineTo(-5,25);
  ctx.lineTo(5,25);
  ctx.stroke();

  // bouche
  ctx.beginPath();
  if(emotion==="shock"){
    ctx.arc(0,50,15,0,Math.PI*2);
  } else {
    ctx.moveTo(-20,50);
    ctx.lineTo(20,50);
  }
  ctx.stroke();

  if(scar){
    ctx.beginPath();
    ctx.moveTo(30,-40);
    ctx.lineTo(60,30);
    ctx.stroke();
  }

  // costume
  ctx.beginPath();
  ctx.moveTo(-70,90);
  ctx.lineTo(0,220);
  ctx.lineTo(70,90);
  ctx.stroke();

  ctx.restore();
}

/* ===================== REALISTIC HAND ===================== */

function drawHand(x,y,scale,holdingCards=false){

  ctx.save();
  ctx.translate(x,y);
  ctx.scale(scale,scale);
  ctx.lineWidth=1.2;
  ctx.strokeStyle="white";

  // paume
  ctx.beginPath();
  ctx.ellipse(0,0,40,60,0,0,Math.PI*2);
  ctx.stroke();

  // doigts
  for(let i=-30;i<=30;i+=20){
    ctx.beginPath();
    ctx.ellipse(i,-70,15,40,0,0,Math.PI*2);
    ctx.stroke();
  }

  if(holdingCards){
    ctx.strokeRect(-50,-120,80,120);
    ctx.strokeRect(-40,-130,80,120);
  }

  ctx.restore();
}

/* ===================== REALISTIC GUN ===================== */

function drawGun(x,y,scale,aim=false){
  ctx.save();
  ctx.translate(x,y);
  ctx.scale(scale,scale);
  ctx.lineWidth=2;

  ctx.strokeRect(-20,-20,200,40);
  ctx.strokeRect(0,-40,150,20);

  ctx.beginPath();
  ctx.moveTo(60,20);
  ctx.lineTo(90,150);
  ctx.lineTo(40,150);
  ctx.closePath();
  ctx.stroke();

  if(aim){
    ctx.beginPath();
    ctx.moveTo(200,0);
    ctx.lineTo(260,0);
    ctx.stroke();
  }

  ctx.restore();
}

/* ===================== SCENES ===================== */

function drawScene(){

  ctx.fillStyle="black";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.save();
  applyCamera();

  if(scene!==lastScene){
    ui.innerHTML="";
    if(scene===4){
      let b1=document.createElement("button");
      b1.textContent="TIRER";
      b1.onclick=()=>{ choice="kill"; playersAlive=3; scene++; };

      let b2=document.createElement("button");
      b2.textContent="DONNER DES JETONS";
      b2.onclick=()=>{ choice="spare"; playersAlive=4; scene++; };

      ui.appendChild(b1);
      ui.appendChild(b2);
    }
    lastScene=scene;
  }

  switch(scene){

    case 0:
      zoomTarget=0.8;
      caption("Une table. Quatre hommes. Une nuit sans témoin.");
      break;

    case 1:
      zoomTarget=1;
      drawHand(canvas.width/2,canvas.height-200,1,true);
      caption("Mes cartes tremblent. Pas mes doigts.");
      break;

    case 2:
      zoomTarget=1.2;
      drawRealFace(canvas.width/2,canvas.height/2,1,"neutral",true);
      caption("Il me regarde comme on regarde un verdict.");
      break;

    case 3:
      zoomTarget=1.5;
      drawRealFace(canvas.width/2,canvas.height/2,1.2,"shock",true);
      caption("Dans ses pupilles : la peur.");
      break;

    case 4:
      caption("Que vaut une victoire ?");
      break;

    case 5:
      zoomTarget=1;
      drawGun(canvas.width/2,canvas.height/2,1,true);
      caption("Le métal ne doute jamais.");
      break;

    case 6:
      zoomTarget=2;
      drawRealFace(canvas.width/2,canvas.height/2,1.5,"neutral",false);
      caption("Il reste toujours quelqu'un.");
      break;

    case 7:
      zoomTarget=1.5;
      drawGun(canvas.width/2-300,canvas.height/2,1.2,true);
      caption("Survivre n'est pas gagner.");
      break;

    case 8:
      ctx.fillStyle="white";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      break;
  }

  ctx.restore();
}

/* ===================== INPUT ===================== */

canvas.addEventListener("click",()=>{
  if(scene!==4 && scene<8){
    scene++;
  }
});

/* ===================== LOOP ===================== */

function loop(){
  updateCamera();
  drawScene();
  t++;
  requestAnimationFrame(loop);
}
loop();

</script>
</body>
</html>
