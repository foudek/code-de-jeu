<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Dernière Mise</title>
<style>
html,body{
  margin:0;
  background:black;
  overflow:hidden;
  color:white;
  font-family: monospace;
}
canvas{
  display:block;
}
#ui{
  position:fixed;
  bottom:40px;
  width:100%;
  display:flex;
  justify-content:center;
  gap:40px;
  pointer-events:none;
}
button{
  pointer-events:auto;
  background:none;
  color:white;
  border:1px solid white;
  padding:14px 28px;
  font-size:16px;
  cursor:pointer;
}
button:hover{
  background:white;
  color:black;
}
</style>
</head>
<body>

<canvas id="c"></canvas>

<div id="ui"></div>

<script>
/* ================= SETUP ================= */
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const ui = document.getElementById("ui");

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
addEventListener("resize",resize);
resize();

let t = 0;
let scene = 0;
let choice = null;

/* ================= CAMERA ================= */
function camera(intensity=1.5){
  ctx.translate(
    Math.sin(t*0.04)*intensity,
    Math.cos(t*0.03)*intensity
  );
}

/* ================= TEXT ================= */
function caption(txt){
  ctx.font="18px monospace";
  ctx.fillStyle="white";
  ctx.fillText(txt,40,80);
}

/* ================= CHARACTERS ================= */
function face({scar=false,cigar=false,eye=false,zoom=1,shock=false}){
  const cx = canvas.width/2;
  const cy = canvas.height/2;

  const breath = Math.sin(t*0.03)*2;

  ctx.save();
  ctx.translate(cx,cy);
  ctx.scale(zoom + breath*0.002, zoom + breath*0.002);
  ctx.translate(-cx,-cy);

  ctx.strokeStyle="white";
  ctx.lineWidth=1.2;

  // head contour
  ctx.beginPath();
  ctx.arc(cx,cy,90,0,Math.PI*2);
  ctx.stroke();

  // eye
  ctx.beginPath();
  ctx.arc(cx-30,cy-10,20,Math.PI*0.1,Math.PI*0.9);
  ctx.stroke();

  if(eye){
    ctx.beginPath();
    ctx.moveTo(cx-50,cy-10);
    ctx.lineTo(cx-10,cy-10);
    ctx.stroke();
  }

  // mouth
  ctx.beginPath();
  if(shock){
    ctx.arc(cx-20,cy+40,10,0,Math.PI*2);
  }else{
    ctx.moveTo(cx-40,cy+40);
    ctx.lineTo(cx,cy+40);
  }
  ctx.stroke();

  // scar
  if(scar){
    ctx.beginPath();
    ctx.moveTo(cx+10,cy-30);
    ctx.lineTo(cx+40,cy+10);
    ctx.stroke();
  }

  // cigar
  if(cigar){
    ctx.beginPath();
    ctx.moveTo(cx+10,cy+45);
    ctx.lineTo(cx+50,cy+50);
    ctx.stroke();
  }

  // suit
  ctx.beginPath();
  ctx.moveTo(cx-80,cy+90);
  ctx.lineTo(cx,cy+160);
  ctx.lineTo(cx+80,cy+90);
  ctx.stroke();

  ctx.restore();
}

/* ================= OBJECTS ================= */
function gun(){
  ctx.strokeStyle="white";
  ctx.lineWidth=2;
  ctx.beginPath();
  ctx.arc(canvas.width/2,canvas.height/2,90,0,Math.PI*2);
  ctx.stroke();
  ctx.beginPath();
  ctx.arc(canvas.width/2,canvas.height/2,40,0,Math.PI*2);
  ctx.stroke();
}

/* ================= UI ================= */
function clearUI(){
  ui.innerHTML="";
}
function buttons(arr){
  ui.innerHTML="";
  arr.forEach(b=>{
    const btn=document.createElement("button");
    btn.textContent=b.text;
    btn.onclick=b.action;
    ui.appendChild(btn);
  });
}

/* ================= SCENES ================= */
function drawScene(){
  ctx.fillStyle="black";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.save();
  camera();

  switch(scene){

    case 0:
      caption("TABLE DE POKER. COSTUMES. SILENCE.");
      face({zoom:1});
      buttons([
        {text:"TIRER",action:()=>{choice="kill";scene++;}},
        {text:"DONNER DES JETONS",action:()=>{choice="spare";scene++;}}
      ]);
      break;

    case 1:
      clearUI();
      caption("Il perd la manche.");
      face({shock:true,zoom:1.15});
      break;

    case 2:
      caption(choice==="kill"?"Trois joueurs restants.":"Quatre joueurs. Tension.");
      face({scar:true});
      break;

    case 3:
      caption("Regard figé.");
      face({cigar:true,zoom:1.25});
      break;

    case 4:
      caption("Un œil ne cligne pas.");
      face({eye:true,zoom:1.35});
      break;

    case 5:
      caption("Silence.");
      gun();
      break;

    case 6:
      ctx.fillStyle="white";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      clearUI();
      break;
  }

  ctx.restore();
}

/* ================= LOOP ================= */
function loop(){
  drawScene();
  t++;
  requestAnimationFrame(loop);
}
loop();

/* ================= INPUT ================= */
canvas.addEventListener("click",()=>{
  if(scene>0 && scene<6){
    scene++;
  }
});
</script>

</body>
</html>
