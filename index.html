<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>LG Winrate Simulator - 3 Tours</title>
<style>
body { background:#111; color:#eee; font-family:Arial; padding:20px; }
input, button { padding:6px; margin:5px 0; width:220px; }
button { cursor:pointer; }
.result { margin-top:20px; font-size:18px; line-height:1.6; }
</style>
</head>
<body>

<h2>Simulateur Loup-Garou (8 joueurs, 2 loups, 3 tours max)</h2>

<label>Nombre de joueurs dévoilement</label><br>
<input type="number" id="revealed" value="2" min="0" max="8"><br>

<label>Nombre de simulations</label><br>
<input type="number" id="games" value="100"><br>

<button onclick="simulate()">Simuler</button>

<div class="result" id="result"></div>

<script>

function randomChoice(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

function simulateGame(revealedCount) {

  const players = 8;
  const wolvesCount = 2;

  // Création des rôles
  let roles = ["wolf","wolf"];
  while (roles.length < players) roles.push("villager");
  roles.sort(() => Math.random() - 0.5);

  let alive = Array(players).fill(true);

  // Tirage dévoilement
  let revealed = new Set();
  while (revealed.size < revealedCount) {
    revealed.add(Math.floor(Math.random() * players));
  }

  // Loups dévoilés meurent immédiatement
  revealed.forEach(i => {
    if (roles[i] === "wolf") alive[i] = false;
  });

  function countAlive(type) {
    return roles.filter((r,i)=>r===type && alive[i]).length;
  }

  function aliveIndexes() {
    return roles.map((r,i)=>alive[i]?i:null).filter(i=>i!==null);
  }

  function checkWin() {
    let wolvesAlive = countAlive("wolf");
    let villagersAlive = aliveIndexes().length - wolvesAlive;
    if (wolvesAlive === 0) return "village";
    if (wolvesAlive >= villagersAlive) return "wolves";
    return null;
  }

  // 3 tours max
  for (let turn = 1; turn <= 3; turn++) {

    // --- NUIT ---
    let nightTargets = aliveIndexes().filter(i =>
      roles[i] !== "wolf" &&
      !(revealed.has(i) && roles[i] === "villager")
    );

    if (nightTargets.length > 0) {
      alive[randomChoice(nightTargets)] = false;
    }

    let win = checkWin();
    if (win) return {winner: win, turn: turn};

    // --- JOUR ---
    let dayTargets = aliveIndexes().filter(i =>
      !(revealed.has(i) && roles[i] === "villager")
    );

    if (dayTargets.length > 0) {
      alive[randomChoice(dayTargets)] = false;
    }

    win = checkWin();
    if (win) return {winner: win, turn: turn};
  }

  return {winner: "village", turn: 3};
}

function simulate() {

  const revealed = +document.getElementById("revealed").value;
  const games = +document.getElementById("games").value;

  let wolfWins = 0;
  let villageWins = 0;

  let wolfTurnWins = [0,0,0];
  let villageTurnWins = [0,0,0];

  for (let i = 0; i < games; i++) {
    let result = simulateGame(revealed);

    if (result.winner === "wolves") {
      wolfWins++;
      wolfTurnWins[result.turn-1]++;
    } else {
      villageWins++;
      villageTurnWins[result.turn-1]++;
    }
  }

  document.getElementById("result").innerHTML = `
  <strong>Résultat global :</strong><br>
  Victoire Loups : ${(wolfWins/games*100).toFixed(1)}%<br>
  Victoire Village : ${(villageWins/games*100).toFixed(1)}%<br><br>

  <strong>Détail par tour :</strong><br>
  Tour 1 → Loups: ${(wolfTurnWins[0]/games*100).toFixed(1)}% | Village: ${(villageTurnWins[0]/games*100).toFixed(1)}%<br>
  Tour 2 → Loups: ${(wolfTurnWins[1]/games*100).toFixed(1)}% | Village: ${(villageTurnWins[1]/games*100).toFixed(1)}%<br>
  Tour 3 → Loups: ${(wolfTurnWins[2]/games*100).toFixed(1)}% | Village: ${(villageTurnWins[2]/games*100).toFixed(1)}%
  `;
}

</script>
</body>
</html>
