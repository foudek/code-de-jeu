<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Dernière Mise</title>
<style>
html,body{
    margin:0;
    background:black;
    overflow:hidden;
}
canvas{display:block;}
</style>
</head>
<body>
<canvas id="c"></canvas>

<script>
/* =========================
   SETUP
========================= */
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
addEventListener("resize",resize);
resize();

let t = 0;
let choice = null;
let timeline = [];
let currentScene = 0;
let sceneStart = 0;

/* =========================
   UTILITIES
========================= */
function camShake(intensity=2){
  ctx.translate(
    Math.sin(t*0.08)*intensity,
    Math.cos(t*0.07)*intensity
  );
}

function text(txt,y){
  ctx.font="18px monospace";
  ctx.fillStyle="white";
  ctx.fillText(txt,40,y);
}

/* =========================
   DRAWING (REALISTIC TRAITS)
========================= */
function faceExpression(type){
  const cx = canvas.width/2;
  const cy = canvas.height/2;

  const breath = Math.sin(t*0.03)*3;
  ctx.save();
  ctx.translate(cx,cy);
  ctx.scale(1+breath*0.002,1+breath*0.002);
  ctx.translate(-cx,-cy);

  ctx.strokeStyle="white";
  ctx.lineWidth=1.2;

  // eye
  ctx.beginPath();
  ctx.arc(cx-40,cy,28,Math.PI*0.1,Math.PI*0.9);
  ctx.stroke();

  // eyelid emotion
  let lid = type==="shock"?10:type==="fear"?4:1;
  ctx.beginPath();
  ctx.moveTo(cx-70,cy);
  ctx.lineTo(cx-10,cy+lid);
  ctx.stroke();

  // mouth
  ctx.beginPath();
  if(type==="shock"){
    ctx.arc(cx-40,cy+60,14,0,Math.PI*2);
  }else{
    ctx.moveTo(cx-60,cy+60);
    ctx.lineTo(cx-20,cy+60);
  }
  ctx.stroke();

  ctx.restore();
}

function pokerTable(players){
  ctx.strokeStyle="white";
  ctx.lineWidth=1;
  ctx.strokeRect(
    canvas.width/2-200,
    canvas.height/2-100,
    400,200
  );
  for(let i=0;i<players;i++){
    ctx.beginPath();
    ctx.arc(
      canvas.width/2-120+i*(240/(players-1||1)),
      canvas.height/2+140,
      20,0,Math.PI*2
    );
    ctx.stroke();
  }
}

function gunFront(){
  ctx.strokeStyle="white";
  ctx.lineWidth=2;
  ctx.beginPath();
  ctx.arc(canvas.width/2,canvas.height/2,80,0,Math.PI*2);
  ctx.stroke();
  ctx.beginPath();
  ctx.arc(canvas.width/2,canvas.height/2,40,0,Math.PI*2);
  ctx.stroke();
}

/* =========================
   SCENES
========================= */
function intro(){
  text("TABLE DE POKER. SILENCE.",80);
  text("Un joueur n'a plus de jetons.",110);
  text("[CLIQUE À GAUCHE] Tirer",160);
  text("[CLIQUE À DROITE] Donner des jetons",190);
}

function lossReaction(){
  faceExpression("shock");
  text("Il a perdu la manche.",80);
}

function pokerScene(players){
  pokerTable(players);
  text("Cartes. Jetons. Regards.",80);
}

function finalGun(){
  gunFront();
  text("Respiration.",80);
  text("Décision.",110);
}

/* =========================
   TIMELINE
========================= */
function buildTimeline(){
  timeline = [
    {dur:8000, draw:intro},
    {dur:6000, draw:lossReaction},
    {dur:20000, draw:()=>pokerScene(choice==="kill"?3:4)},
    {dur:6000, draw:()=>faceExpression("fear")},
    {dur:8000, draw:finalGun},
    {dur:2000, draw:()=>{ctx.fillStyle="white";ctx.fillRect(0,0,canvas.width,canvas.height);}}
  ];
}

/* =========================
   LOOP
========================= */
function loop(ts){
  ctx.fillStyle="black";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.save();
  camShake(1.5);

  if(timeline[currentScene]){
    timeline[currentScene].draw();
    if(ts-sceneStart > timeline[currentScene].dur){
      currentScene++;
      sceneStart = ts;
    }
  }

  ctx.restore();
  t++;
  requestAnimationFrame(loop);
}

/* =========================
   INTERACTION
========================= */
canvas.addEventListener("click",e=>{
  if(choice) return;
  choice = e.clientX < innerWidth/2 ? "kill" : "spare";
  buildTimeline();
  sceneStart = performance.now();
});

requestAnimationFrame(loop);
</script>
</body>
</html>
